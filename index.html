<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SIPENTAS ‚Äî BPN NTB ¬∑ Bidang Pengendalian & Penanganan Sengketa</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Syne:wght@400;500;600;700;800&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;1,9..40,300&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root {
    --white: #FFFFFF; --black: #050505; --gray-light: #B3B3B3; --gray-dark: #2B2B2B;
    --bg: #FFFFFF; --surface: #F7F7F7; --border: #E8E8E8; --accent: #050505;
    --text: #050505; --text-muted: #B3B3B3; --text-sub: #2B2B2B;
    --radius: 12px; --radius-sm: 6px;
    --shadow: 0 2px 16px rgba(5,5,5,0.06); --shadow-md: 0 8px 32px rgba(5,5,5,0.10);
    --transition: 0.35s cubic-bezier(0.4,0,0.2,1);
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; overflow-x: hidden; -webkit-font-smoothing: antialiased; margin: 0; }

  /* ‚îÄ‚îÄ‚îÄ HALAMAN LOGIN ‚îÄ‚îÄ‚îÄ */
  #login-container { display: flex; min-height: 100vh; width: 100vw; background: var(--white); }
  .login-left { flex: 1.2; background: var(--black); color: var(--white); position: relative; display: flex; flex-direction: column; justify-content: space-between; padding: 60px; overflow: hidden; }
  .login-left::before { content: ''; position: absolute; top: -20%; left: -10%; width: 150%; height: 150%; background: radial-gradient(circle at top left, rgba(255,255,255,0.1) 0%, transparent 60%); pointer-events: none; }
  .login-left-content { position: relative; z-index: 2; max-width: 480px; margin: auto 0; }
  .login-left h1 { font-family: 'DM Serif Display', serif; font-size: 46px; line-height: 1.1; margin-bottom: 20px; }
  .login-left h1 em { font-style: italic; color: rgba(255,255,255,0.5); }
  .login-left p { font-size: 15px; line-height: 1.6; color: rgba(255,255,255,0.7); margin-bottom: 40px; }
  .login-left-footer { position: relative; z-index: 2; font-size: 11px; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 0.08em; }

  .login-right { flex: 1; display: flex; align-items: center; justify-content: center; background: var(--bg); padding: 40px; position: relative; }
  .login-form-box { width: 100%; max-width: 380px; }
  .login-brand { display: flex; align-items: center; gap: 14px; margin-bottom: 40px; }
  .login-brand-icon { width: 44px; height: 44px; background: var(--black); color: var(--white); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
  .login-brand-text h2 { font-family: 'DM Serif Display', serif; font-size: 24px; line-height: 1; }
  .login-brand-text p { font-family: 'Syne', sans-serif; font-size: 10px; font-weight: 700; letter-spacing: 0.1em; color: var(--text-muted); text-transform: uppercase; margin-top: 4px; }
  
  .pw-wrapper { position: relative; }
  .pw-toggle { position: absolute; right: 14px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: var(--text-muted); padding: 0; display: flex; align-items: center; justify-content: center; transition: color 0.2s; }
  .pw-toggle:hover { color: var(--black); }
  
  /* BOX INFO DEMO LOGIN */
  .demo-accounts { margin-top: 32px; padding: 16px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-sm); font-size: 12px; color: var(--text-sub); }
  .demo-accounts strong { color: var(--black); display: block; margin-bottom: 8px; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; }
  .demo-accounts ul { list-style: none; padding: 0; margin: 0; }
  .demo-accounts li { margin-bottom: 6px; display: flex; justify-content: space-between; border-bottom: 1px dashed var(--border); padding-bottom: 4px; }
  .demo-accounts li:last-child { border: none; margin: 0; padding: 0; }
  .demo-accounts code { background: var(--white); padding: 2px 6px; border-radius: 4px; font-size: 11px; border: 1px solid var(--border); font-weight: bold; }

  @media (max-width: 900px) { .login-left { display: none; } }

  /* ‚îÄ‚îÄ‚îÄ LAYOUT APLIKASI ‚îÄ‚îÄ‚îÄ */
  #app-container { display: flex; min-height: 100vh; width: 100vw; }

  /* ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ */
  .sidebar { width: 260px; background: var(--black); color: var(--white); display: flex; flex-direction: column; position: fixed; left: 0; top: 0; bottom: 0; z-index: 100; transition: transform var(--transition); overflow: hidden; }
  .sidebar::before { content: ''; position: absolute; top: -120px; left: -80px; width: 320px; height: 320px; background: radial-gradient(circle, rgba(179,179,179,0.08) 0%, transparent 70%); pointer-events: none; }
  .sidebar-brand { padding: 28px 24px 20px; border-bottom: 1px solid rgba(255,255,255,0.07); }
  .brand-badge { display: inline-flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10); border-radius: 20px; padding: 4px 12px 4px 4px; margin-bottom: 14px; }
  .brand-dot { width: 20px; height: 20px; background: var(--white); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
  .brand-dot svg { width: 10px; height: 10px; }
  .brand-badge span { font-family: 'Syne', sans-serif; font-size: 10px; font-weight: 600; letter-spacing: 0.08em; opacity: 0.7; text-transform: uppercase; }
  .brand-title { font-family: 'DM Serif Display', serif; font-size: 22px; line-height: 1.2; color: var(--white); }
  .brand-title em { font-style: italic; color: var(--gray-light); }
  .brand-sub { font-size: 11px; color: rgba(255,255,255,0.4); margin-top: 4px; letter-spacing: 0.02em; line-height: 1.5; }
  
  .sidebar-nav { padding: 16px 12px; flex: 1; overflow-y: auto; }
  .nav-section-label { font-family: 'Syne', sans-serif; font-size: 10px; font-weight: 700; letter-spacing: 0.12em; text-transform: uppercase; color: rgba(255,255,255,0.25); padding: 12px 12px 6px; }
  .nav-item { display: flex; align-items: center; gap: 12px; padding: 10px 12px; border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s ease; position: relative; margin-bottom: 2px; color: rgba(255,255,255,0.55); font-size: 13.5px; font-weight: 400; user-select: none; }
  .nav-item svg { width: 16px; height: 16px; opacity: 0.7; flex-shrink: 0; }
  .nav-item:hover { background: rgba(255,255,255,0.07); color: var(--white); } .nav-item:hover svg { opacity: 1; }
  .nav-item.active { background: rgba(255,255,255,0.10); color: var(--white); font-weight: 500; } .nav-item.active svg { opacity: 1; }
  .nav-item.active::before { content: ''; position: absolute; left: 0; top: 20%; height: 60%; width: 2px; background: var(--white); border-radius: 2px; }
  .nav-badge { margin-left: auto; background: rgba(255,255,255,0.12); color: rgba(255,255,255,0.6); font-size: 10px; font-weight: 600; padding: 2px 7px; border-radius: 10px; }
  .nav-item.active .nav-badge { background: var(--white); color: var(--black); }
  .sidebar-footer { padding: 16px 24px; border-top: 1px solid rgba(255,255,255,0.07); font-size: 11px; color: rgba(255,255,255,0.25); line-height: 1.6; }

  /* ‚îÄ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ‚îÄ */
  .main { margin-left: 260px; flex: 1; display: flex; flex-direction: column; min-height: 100vh; transition: margin var(--transition); min-width: 0; }
  .topbar { position: sticky; top: 0; z-index: 50; background: rgba(255,255,255,0.92); backdrop-filter: blur(12px); border-bottom: 1px solid var(--border); padding: 0 36px; height: 64px; display: flex; align-items: center; justify-content: space-between; }
  .topbar-left { display: flex; align-items: center; gap: 12px; }
  .page-crumb { font-size: 12px; color: var(--text-muted); letter-spacing: 0.02em; } .page-crumb span { color: var(--text); font-weight: 500; }
  .topbar-right { display: flex; align-items: center; gap: 16px; }
  
  /* ROLE BADGE DI TOPBAR */
  .role-indicator { font-size: 10px; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; background: var(--surface); border: 1px solid var(--border); padding: 4px 10px; border-radius: 20px; color: var(--text-muted); display: flex; align-items: center; gap: 6px; }
  .role-indicator .dot { width: 6px; height: 6px; background: #1B5E20; border-radius: 50%; }

  .dropdown { position: relative; display: inline-block; }
  .user-chip { display: flex; align-items: center; gap: 10px; background: var(--surface); border: 1px solid var(--border); border-radius: 20px; padding: 6px 14px 6px 6px; cursor: pointer; transition: all 0.2s; user-select: none; }
  .user-chip:hover { border-color: var(--black); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
  .user-avatar { width: 28px; height: 28px; background: var(--black); color: var(--white); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: 'Syne', sans-serif; font-size: 11px; font-weight: 700; overflow:hidden; }
  .user-name { font-size: 12px; font-weight: 500; color: var(--text); }
  .dropdown-menu { position: absolute; top: calc(100% + 8px); right: 0; background: var(--white); border: 1px solid var(--border); border-radius: var(--radius-sm); box-shadow: var(--shadow-md); min-width: 160px; display: none; flex-direction: column; z-index: 1000; overflow: hidden; }
  .dropdown-menu.show { display: flex; animation: fadeDown 0.2s ease; }
  @keyframes fadeDown { from{opacity:0; transform:translateY(-10px);} to{opacity:1; transform:translateY(0);} }
  .dropdown-item { padding: 12px 16px; font-size: 13px; color: var(--text); cursor: pointer; display: flex; align-items: center; gap: 10px; transition: background 0.2s; text-decoration: none; font-family: 'DM Sans', sans-serif; border:none; background:none; text-align:left; width:100%; }
  .dropdown-item:hover { background: var(--surface); }
  .dropdown-item.danger:hover { color: #C0392B; }

  /* ‚îÄ‚îÄ‚îÄ PAGE & COMPONENTS ‚îÄ‚îÄ‚îÄ */
  .content { padding: 36px; flex: 1; transition: padding var(--transition); }
  .page { display: none; } .page.active { display: block; animation: pageIn 0.45s cubic-bezier(0.4,0,0.2,1); }
  @keyframes pageIn { from { opacity: 0; transform: translateY(18px); } to { opacity: 1; transform: translateY(0); } }

  .page-header { margin-bottom: 32px; }
  .page-header h1 { font-family: 'DM Serif Display', serif; font-size: 32px; line-height: 1.15; color: var(--text); }
  .page-header h1 em { font-style: italic; color: var(--gray-light); }
  .page-header p { color: var(--text-muted); font-size: 14px; margin-top: 6px; }

  .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
  .stat-card { background: var(--white); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px 22px; transition: box-shadow 0.2s, transform 0.2s; cursor: default; position: relative; overflow: hidden; }
  .stat-card::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 2px; background: var(--black); transform: scaleX(0); transform-origin: left; transition: transform 0.3s ease; }
  .stat-card:hover { box-shadow: var(--shadow-md); transform: translateY(-2px); } .stat-card:hover::after { transform: scaleX(1); }
  .stat-label { font-size: 11px; font-weight: 600; letter-spacing: 0.08em; text-transform: uppercase; color: var(--text-muted); margin-bottom: 10px; }
  .stat-value { font-family: 'DM Serif Display', serif; font-size: 36px; line-height: 1; color: var(--text); }
  .stat-meta { font-size: 12px; color: var(--text-muted); margin-top: 6px; } .stat-meta strong { color: var(--text-sub); }

  .chart-grid { display: grid; grid-template-columns: 2.5fr 1fr; gap: 20px; margin-bottom: 24px; }
  .dashboard-grid { display: grid; grid-template-columns: 1fr 340px; gap: 20px; }
  
  .card { background: var(--white); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; min-width: 0; }
  .card-header { padding: 18px 22px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
  .card-title { font-family: 'Syne', sans-serif; font-size: 13px; font-weight: 700; letter-spacing: 0.04em; color: var(--text); }
  .card-body { padding: 22px; }

  /* ‚îÄ‚îÄ‚îÄ TABEL DATA & SCROLLING ‚îÄ‚îÄ‚îÄ */
  .scrollable { overflow-x: auto; width: 100%; -webkit-overflow-scrolling: touch; display: block; }
  .data-table { width: 100%; border-collapse: collapse; }
  .data-table th { text-align: left; padding: 10px 14px; font-family: 'Syne', sans-serif; font-size: 10px; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; color: var(--text-muted); border-bottom: 1px solid var(--border); white-space: nowrap; }
  .data-table td { padding: 12px 14px; font-size: 13px; border-bottom: 1px solid var(--border); vertical-align: middle; white-space: nowrap; }
  .data-table tr { transition: background 0.15s; cursor: pointer; } .data-table tr:hover td { background: var(--surface); }
  
  .badge { display: inline-flex; align-items: center; gap: 5px; padding: 3px 9px; border-radius: 20px; font-size: 11px; font-weight: 600; white-space: nowrap; }
  .badge-admin { background: #F0F0F0; color: var(--gray-dark); border: 1px solid #E0E0E0; } .badge-court { background: var(--black); color: var(--white); }
  .badge-dot { width: 5px; height: 5px; border-radius: 50%; }
  .status-badge { display: inline-flex; align-items: center; gap: 4px; padding: 3px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
  .status-1 { background: #FFF8E1; color: #B7791F; } .status-2 { background: #E8F5E9; color: #2E7D32; } .status-3 { background: #E3F2FD; color: #1565C0; } .status-4 { background: #F3E5F5; color: #6A1B9A; } .status-5 { background: #E8F5E9; color: #1B5E20; } .status-0 { background: var(--surface); color: var(--text-muted); }
  
  .pipeline { display: flex; gap: 4px; align-items: center; flex-wrap: nowrap; overflow: hidden; }
  .pipe-step { flex: 1; height: 4px; background: var(--border); border-radius: 2px; position: relative; min-width: 0; }
  .pipe-step.done { background: var(--black); } .pipe-step.active { background: var(--gray-dark); }

  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; } .form-grid.full { grid-template-columns: 1fr; }
  .form-group { display: flex; flex-direction: column; gap: 6px; } .form-group label { font-size: 11px; font-weight: 700; letter-spacing: 0.06em; text-transform: uppercase; color: var(--text-muted); cursor: pointer; }
  .form-control { padding: 10px 14px; border: 1px solid var(--border); border-radius: var(--radius-sm); background: var(--white); font-family: 'DM Sans', sans-serif; font-size: 13.5px; color: var(--text); outline: none; transition: border-color 0.2s, box-shadow 0.2s; width: 100%; }
  .form-control:focus { border-color: var(--black); box-shadow: 0 0 0 3px rgba(5,5,5,0.06); }
  .form-control:disabled { background: var(--surface); cursor: not-allowed; opacity: 0.7; }
  select.form-control { cursor: pointer; } textarea.form-control { resize: vertical; min-height: 80px; }
  
  .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 10px 20px; border-radius: var(--radius-sm); font-family: 'DM Sans', sans-serif; font-size: 13.5px; font-weight: 500; cursor: pointer; border: none; outline: none; transition: all 0.2s; white-space: nowrap; }
  .btn-primary { background: var(--black); color: var(--white); } .btn-primary:hover { background: var(--gray-dark); }
  .btn-secondary { background: var(--white); color: var(--text); border: 1px solid var(--border); } .btn-secondary:hover { border-color: var(--gray-dark); }
  .btn-ghost { background: none; color: var(--text-muted); border: none; } .btn-ghost:hover { color: var(--text); }
  .btn-sm { padding: 7px 14px; font-size: 12px; }
  .btn-danger { background: #FFF5F5; color: #C0392B; border: 1px solid #FFD0CC; } .btn-danger:hover { background: #FFE8E5; }
  .btn-full { width: 100%; }
  .divider { height: 1px; background: var(--border); margin: 24px 0; }

  /* ‚îÄ‚îÄ‚îÄ DETAIL VIEW, STEPPER & AUDIT TRAIL ‚îÄ‚îÄ‚îÄ */
  .detail-header { background: var(--black); color: var(--white); border-radius: var(--radius); padding: 28px; margin-bottom: 20px; position: relative; overflow: hidden; }
  .detail-header::before { content: ''; position: absolute; right: -40px; top: -40px; width: 200px; height: 200px; background: radial-gradient(circle, rgba(255,255,255,0.04) 0%, transparent 70%); }
  .detail-case-id { font-family: 'Syne', sans-serif; font-size: 11px; font-weight: 700; letter-spacing: 0.10em; opacity: 0.5; margin-bottom: 8px; }
  .detail-title { font-family: 'DM Serif Display', serif; font-size: 22px; line-height: 1.3; margin-bottom: 10px; }
  .detail-metas { display: flex; gap: 20px; flex-wrap: wrap; } .detail-meta-item { font-size: 12px; opacity: 0.6; } .detail-meta-item strong { opacity: 1; margin-right: 4px; }
  
  .stepper { margin: 20px 0; }
  .step-item { display: flex; gap: 16px; padding: 16px 0; border-bottom: 1px solid var(--border); position: relative; }
  .step-item:last-child { border-bottom: none; }
  .step-num { width: 32px; height: 32px; flex-shrink: 0; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: 'Syne', sans-serif; font-size: 12px; font-weight: 700; }
  .step-num.done { background: var(--black); color: var(--white); }
  .step-num.active { background: var(--gray-dark); color: var(--white); }
  .step-num.pending { background: var(--surface); color: var(--text-muted); border: 1px solid var(--border); }
  .step-num.success { background: #1B5E20; color: var(--white); box-shadow: 0 0 0 3px rgba(27, 94, 32, 0.2); }
  .step-content { flex: 1; min-width: 0; }
  .step-content .step-title { font-size: 13.5px; font-weight: 600; margin-bottom: 4px; display: flex; align-items: center; }
  .step-content .step-date { font-size: 11px; color: var(--text-muted); margin-bottom: 6px; }
  .step-content .step-note { font-size: 12px; color: var(--text-sub); background: var(--surface); border-radius: var(--radius-sm); padding: 8px 12px; margin-top: 4px; }

  /* Audit Trail List */
  .audit-timeline { margin-top: 10px; }
  .audit-item { display: flex; gap: 14px; margin-bottom: 16px; position: relative; }
  .audit-item::before { content: ''; position: absolute; left: 6px; top: 20px; bottom: -16px; width: 1px; border-left: 1px dashed var(--border); }
  .audit-item:last-child::before { display: none; }
  .audit-dot { width: 13px; height: 13px; border-radius: 50%; background: var(--surface); border: 2px solid var(--gray-dark); flex-shrink: 0; margin-top: 4px; position: relative; z-index: 2; }
  .audit-content { flex: 1; background: var(--surface); padding: 12px 16px; border-radius: var(--radius-sm); border: 1px solid var(--border); }
  .audit-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 6px; }
  .audit-user { font-size: 13px; font-weight: 600; color: var(--text); }
  .audit-role { font-size: 10px; background: rgba(5,5,5,0.06); padding: 2px 6px; border-radius: 4px; margin-left: 6px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;}
  .audit-time { font-size: 11px; color: var(--text-muted); }
  .audit-action { font-size: 12px; color: var(--text-sub); line-height: 1.5; }

  /* ‚îÄ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ‚îÄ */
  .modal-overlay { position: fixed; inset: 0; z-index: 200; background: rgba(5,5,5,0.5); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
  .modal-overlay.open { opacity: 1; pointer-events: all; }
  .modal { background: var(--white); border-radius: var(--radius); width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; box-shadow: 0 24px 80px rgba(5,5,5,0.2); transform: translateY(20px) scale(0.97); transition: transform 0.35s cubic-bezier(0.4,0,0.2,1); }
  .modal-overlay.open .modal { transform: none; }
  .modal-header { padding: 22px 24px 18px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; background: var(--white); z-index: 1; }
  .modal-title { font-family: 'DM Serif Display', serif; font-size: 20px; }
  .modal-close { width: 32px; height: 32px; border: 1px solid var(--border); border-radius: var(--radius-sm); background: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
  .modal-close:hover { background: var(--surface); } .modal-close svg { width: 14px; height: 14px; }
  .modal-body { padding: 24px; } .modal-footer { padding: 16px 24px; border-top: 1px solid var(--border); display: flex; gap: 10px; justify-content: flex-end; }

  /* ‚îÄ‚îÄ‚îÄ UTILITIES & CALENDAR ‚îÄ‚îÄ‚îÄ */
  #toast-container { position: fixed; bottom: 28px; right: 28px; z-index: 999; display: flex; flex-direction: column; gap: 10px; }
  .toast { background: var(--black); color: var(--white); padding: 13px 20px; border-radius: var(--radius-sm); font-size: 13px; display: flex; align-items: center; gap: 10px; box-shadow: var(--shadow-md); animation: toastIn 0.35s cubic-bezier(0.4,0,0.2,1); max-width: 320px; }
  .toast.success { background: #1B5E20; } .toast.error { background: #B71C1C; }
  @keyframes toastIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: none; } }

  ::-webkit-scrollbar { width: 6px; height: 6px; } ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; } ::-webkit-scrollbar-thumb:hover { background: var(--gray-light); }
  
  .progress-bar { background: var(--border); border-radius: 3px; height: 6px; overflow: hidden; }
  .progress-fill { height: 100%; background: var(--black); border-radius: 3px; transition: width 0.6s ease; }
  .tabs { display: flex; gap: 2px; background: var(--surface); border-radius: var(--radius-sm); padding: 4px; margin-bottom: 20px; width: fit-content; }
  .tab { padding: 7px 16px; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s; color: var(--text-muted); border: none; background: none; font-family: 'DM Sans', sans-serif; }
  .tab.active { background: var(--white); color: var(--text); box-shadow: 0 1px 4px rgba(5,5,5,0.08); } .tab:hover:not(.active) { color: var(--text); }
  .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; } .info-item label { font-size: 10px; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; color: var(--text-muted); display: block; margin-bottom: 4px; } .info-item span { font-size: 13.5px; color: var(--text); }

  .calendar-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; } .cal-month-label { font-family: 'DM Serif Display', serif; font-size: 18px; }
  .cal-nav-btns { display: flex; gap: 6px; } .cal-nav-btn { width: 30px; height: 30px; border: 1px solid var(--border); border-radius: var(--radius-sm); background: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; color: var(--text-muted); } .cal-nav-btn:hover { border-color: var(--black); color: var(--black); } .cal-nav-btn svg { width: 14px; height: 14px; }
  .cal-days-header { display: grid; grid-template-columns: repeat(7, 1fr); margin-bottom: 8px; } .cal-day-name { text-align: center; font-size: 10px; font-weight: 700; letter-spacing: 0.06em; text-transform: uppercase; color: var(--text-muted); padding: 4px 0; }
  .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; } .cal-cell { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 12px; border-radius: var(--radius-sm); cursor: pointer; position: relative; transition: all 0.2s; color: var(--text-sub); flex-direction: column; gap: 2px; } .cal-cell:hover { background: var(--surface); } .cal-cell.other-month { color: var(--text-muted); opacity: 0.4; } .cal-cell.today { background: var(--black); color: var(--white) !important; font-weight: 700; } .cal-cell.holiday { color: #c0392b; font-weight: 600; }
  .cal-cell.has-event::after { content: ''; position: absolute; bottom: 4px; width: 4px; height: 4px; background: var(--black); border-radius: 50%; } .cal-cell.today.has-event::after { background: var(--white); } .cal-cell.holiday.has-event::after { background: #c0392b; }
  
  .menu-toggle { display: none; background: none; border: none; cursor: pointer; color: var(--text); padding: 5px; }
  .sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(5,5,5,0.4); z-index: 90; opacity: 0; transition: opacity 0.3s; }
  .sidebar-overlay.active { display: block; opacity: 1; }
  button:focus-visible, input:focus-visible, select:focus-visible, textarea:focus-visible { outline: 2px solid var(--black); outline-offset: 2px; }

  @media (max-width: 1024px) {
    .sidebar { transform: translateX(-100%); } .sidebar.open { transform: translateX(0); }
    .main { margin-left: 0; } .menu-toggle { display: block; } .topbar { padding: 0 20px; } .content { padding: 20px; }
    .chart-grid { grid-template-columns: 1fr; }
  }
  @media (max-width: 768px) {
    .stats-grid { grid-template-columns: 1fr 1fr; } .form-grid { grid-template-columns: 1fr !important; } .info-grid { grid-template-columns: 1fr; } .dashboard-grid { display: flex; flex-direction: column; } .settings-grid { grid-template-columns: 1fr; } .detail-metas { flex-direction: column; gap: 8px; }
  }
  @media (max-width: 480px) { .stats-grid { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<div id="login-container">
  <div class="login-left">
    <div class="login-left-content">
      <h1>Sistem<br>Informasi<br><em>Pengendalian &amp;<br>Penanganan Sengketa</em></h1>
      <p>Portal manajemen data pembatalan hak atas tanah terpadu untuk Kanwil BPN Provinsi Nusa Tenggara Barat.</p>
    </div>
    <div class="login-left-footer">
      Dilindungi oleh sistem otentikasi internal BPN<br>Akses Terbatas
    </div>
  </div>
  
  <div class="login-right">
    <div class="login-form-box">
      <div class="login-brand">
        <div class="login-brand-icon">
          <svg viewBox="0 0 24 24" fill="currentColor" style="width:20px;height:20px;"><circle cx="12" cy="12" r="8"/></svg>
        </div>
        <div class="login-brand-text">
          <h2>SIPENTAS</h2>
          <p>Kanwil BPN Provinsi NTB</p>
        </div>
      </div>
      
      <form onsubmit="handleLogin(event)">
        <div class="form-group" style="margin-bottom:16px">
          <label for="l-username">Nama Pengguna (NIP/ID)</label>
          <input type="text" id="l-username" class="form-control" placeholder="Masukkan ID pengguna" required>
        </div>
        <div class="form-group" style="margin-bottom:20px">
          <label for="l-password">Kata Sandi</label>
          <div class="pw-wrapper">
            <input type="password" id="l-password" class="form-control" placeholder="Masukkan kata sandi" required>
            <button type="button" class="pw-toggle" onclick="togglePassword()" title="Lihat/Sembunyikan Sandi">
              <svg id="pw-icon" viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>
              </svg>
            </button>
          </div>
        </div>
        
        <button type="submit" class="btn btn-primary btn-full" style="font-size:14px; padding:12px; margin-bottom:24px;">Masuk ke Sistem</button>

        <div class="demo-accounts">
          <strong>üìù Akun Uji Coba (Demo Role)</strong>
          <ul>
            <li><span>Admin Kanwil</span> <code>admin</code> / <code>admin123</code></li>
            <li><span>Operator (Inputter)</span> <code>operator</code> / <code>op123</code></li>
            <li><span>Pimpinan (View Only)</span> <code>pimpinan</code> / <code>pim123</code></li>
          </ul>
        </div>
      </form>
    </div>
  </div>
</div>

<div id="app-container" style="display:none;">

  <aside class="sidebar">
    <div class="sidebar-brand">
      <div class="brand-badge"><div class="brand-dot"><svg viewBox="0 0 24 24" fill="currentColor" style="color:#050505"><circle cx="12" cy="12" r="5"/></svg></div><span>BPN ¬∑ NTB</span></div>
      <div class="brand-title">SIPENTAS<em>.</em></div>
      <div class="brand-sub">Sistem Informasi Pengendalian &amp;<br>Penanganan Sengketa</div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-section-label">Utama</div>
      <div class="nav-item active" onclick="navigateTo('dashboard')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg> Dashboard</div>
      <div class="nav-section-label" style="margin-top:8px">Permohonan Pembatalan</div>
      <div class="nav-item" onclick="navigateTo('list-cacat')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg> Cacat Administrasi <span class="nav-badge" id="badge-cacat">0</span></div>
      <div class="nav-item" onclick="navigateTo('list-putusan')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg> Putusan Pengadilan <span class="nav-badge" id="badge-putusan">0</span></div>
      
      <div class="nav-item" id="nav-tambah" onclick="navigateTo('tambah')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg> Tambah Permohonan</div>
      
      <div class="nav-section-label" style="margin-top:8px">Informasi</div>
      <div class="nav-item" onclick="navigateTo('kalender')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg> Kalender Kegiatan</div>
      
      <div class="nav-section-label" style="margin-top:8px">Sistem</div>
      <div class="nav-item" onclick="navigateTo('pengaturan')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg> Pengaturan</div>
    </nav>
    <div class="sidebar-footer">Kantor Wilayah BPN<br>Provinsi Nusa Tenggara Barat</div>
  </aside>

  <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

  <div class="main">
    <header class="topbar">
      <div class="topbar-left">
        <button class="menu-toggle" onclick="toggleSidebar()" aria-label="Menu"><svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button>
        <div class="page-crumb" id="page-crumb">Beranda / <span>Dashboard</span></div>
      </div>
      <div class="topbar-right">
        
        <div class="role-indicator" id="topbar-role-badge">
          <div class="dot"></div> <span id="topbar-role-text">Admin</span>
        </div>

        <div class="search-box" style="height: 36px; min-width: 250px;">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px; height:16px"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
          <input type="text" placeholder="Cari nomor berkas..." id="global-search" oninput="if(currentPage==='list-cacat') filterTable('cacat'); else if(currentPage==='list-putusan') filterTable('putusan');" style="padding: 0;">
        </div>
        
        <div class="dropdown">
          <div class="user-chip" onclick="toggleUserMenu(event)" title="Menu Akun">
            <div class="user-avatar" id="topbar-avatar-container">
              <span id="topbar-avatar-initials">US</span>
            </div>
            <span class="user-name" id="topbar-user-name">Pengguna</span>
            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none" style="margin-left:4px; opacity:0.5;"><polyline points="6 9 12 15 18 9"></polyline></svg>
          </div>
          <div class="dropdown-menu" id="user-dropdown">
            <div style="padding:12px 16px; border-bottom:1px solid var(--border); font-size:11px; color:var(--text-muted);" id="dropdown-role-info">Sistem Terkoneksi</div>
            <a class="dropdown-item" href="javascript:void(0)" onclick="navigateTo('pengaturan')">
              <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg> Pengaturan Profil
            </a>
            <button class="dropdown-item danger" onclick="logout()">
              <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg> Keluar / Log Out
            </button>
          </div>
        </div>

      </div>
    </header>

    <div class="content">
      <div class="page active" id="page-dashboard">
        <div class="page-header"><h1>Selamat Datang<em>,</em> di SIPENTAS</h1><p>Sistem Informasi Pengendalian &amp; Penanganan Sengketa ‚Äî Kanwil BPN NTB</p></div>
        
        <div class="stats-grid">
          <div class="stat-card"><div class="stat-label">Total Permohonan</div><div class="stat-value" id="stat-total">0</div><div class="stat-meta">Seluruh kategori</div></div>
          <div class="stat-card"><div class="stat-label">Cacat Administrasi</div><div class="stat-value" id="stat-cacat">0</div><div class="stat-meta">Permohonan aktif</div></div>
          <div class="stat-card"><div class="stat-label">Putusan Pengadilan</div><div class="stat-value" id="stat-putusan">0</div><div class="stat-meta">Permohonan aktif</div></div>
          <div class="stat-card"><div class="stat-label">Selesai / Ditutup</div><div class="stat-value" id="stat-selesai">0</div><div class="stat-meta">Kasus tuntas</div></div>
        </div>

        <div class="chart-grid">
          <div class="card">
            <div class="card-header"><span class="card-title">Sebaran Kasus per Kantor Pertanahan</span></div>
            <div class="card-body" style="position: relative; height: 320px;">
              <canvas id="kantahChart"></canvas>
            </div>
          </div>
          <div class="card">
            <div class="card-header"><span class="card-title">Proporsi Jenis Kasus</span></div>
            <div class="card-body" style="position: relative; height: 320px; display: flex; justify-content: center; align-items: center;">
              <canvas id="typeChart"></canvas>
            </div>
          </div>
        </div>

        <div class="dashboard-grid">
          <div class="dashboard-main">
            <div class="card">
              <div class="card-header"><span class="card-title">Permohonan Terkini</span><button class="card-action" onclick="navigateTo('list-cacat')">Lihat Semua</button></div>
              <div class="scrollable">
                <table class="data-table">
                  <thead><tr><th>No. Berkas</th><th>Pemohon</th><th>Jenis</th><th>Kantah</th><th>Status</th></tr></thead>
                  <tbody id="recent-cases-tbody"><tr><td colspan="5" style="text-align:center;color:var(--text-muted);padding:32px">Belum ada data</td></tr></tbody>
                </table>
              </div>
            </div>
          </div>
          <div style="display:flex;flex-direction:column;gap:20px">
            <div class="card">
              <div class="card-header"><span class="card-title">Kalender</span><button class="card-action" onclick="navigateTo('kalender')">Atur</button></div>
              <div class="card-body" style="padding:16px"><div class="calendar-header"><div class="cal-month-label" id="mini-cal-label"></div><div class="cal-nav-btns"><button class="cal-nav-btn" onclick="miniCalPrev()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="15 18 9 12 15 6"/></svg></button><button class="cal-nav-btn" onclick="miniCalNext()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="9 18 15 12 9 6"/></svg></button></div></div><div class="cal-days-header"><div class="cal-day-name">Min</div><div class="cal-day-name">Sen</div><div class="cal-day-name">Sel</div><div class="cal-day-name">Rab</div><div class="cal-day-name">Kam</div><div class="cal-day-name">Jum</div><div class="cal-day-name">Sab</div></div><div class="cal-grid" id="mini-cal-grid"></div></div>
            </div>
          </div>
        </div>
      </div>

      <div class="page" id="page-list-cacat">
        <div class="page-header"><h1>Cacat <em>Administrasi</em></h1><p>Daftar permohonan pembatalan berdasarkan cacat administrasi</p></div>
        <div class="search-row" style="justify-content: flex-end;"><select class="filter-select" id="filter-status-cacat" onchange="filterTable('cacat')"><option value="">Semua Tahapan</option><option value="0">Usulan Masuk</option><option value="1">Telaah Staff</option><option value="2">Penelitian Lapang</option><option value="3">Gelar Kasus</option><option value="4">Penerbitan SK</option><option value="5">Selesai / Ditutup</option></select></div>
        <div class="card"><div class="scrollable"><table class="data-table"><thead><tr><th>No. Berkas</th><th>Kantor Pertanahan</th><th>Pemohon</th><th>No. Sertipikat</th><th>Desa/Kecamatan</th><th>Tgl. Usulan</th><th>Tahapan</th><th>Progress</th><th>Aksi</th></tr></thead><tbody id="tbody-cacat"></tbody></table></div></div>
      </div>

      <div class="page" id="page-list-putusan">
        <div class="page-header"><h1>Putusan <em>Pengadilan</em></h1><p>Daftar permohonan pembatalan berdasarkan putusan pengadilan inkracht</p></div>
        <div class="search-row" style="justify-content: flex-end;"><select class="filter-select" id="filter-status-putusan" onchange="filterTable('putusan')"><option value="">Semua Tahapan</option><option value="0">Usulan Masuk</option><option value="1">Telaah Staff</option><option value="2">Penelitian Lapang</option><option value="3">Gelar Kasus</option><option value="4">Penerbitan SK</option><option value="5">Selesai / Ditutup</option></select></div>
        <div class="card"><div class="scrollable"><table class="data-table"><thead><tr><th>No. Berkas</th><th>Kantor Pertanahan</th><th>Pemohon</th><th>No. Putusan</th><th>Desa/Kecamatan</th><th>Tgl. Usulan</th><th>Tahapan</th><th>Progress</th><th>Aksi</th></tr></thead><tbody id="tbody-putusan"></tbody></table></div></div>
      </div>

      <div class="page" id="page-tambah">
        <div class="page-header"><h1>Tambah <em>Permohonan</em></h1><p>Input data permohonan pembatalan baru</p></div>
        <div class="card" style="max-width:820px">
          <div class="card-header"><span class="card-title">Formulir Permohonan</span></div>
          <div class="card-body">
            <div class="tabs" style="margin-bottom:24px"><button type="button" class="tab active" onclick="switchFormTab('info')">Informasi Umum</button><button type="button" class="tab" onclick="switchFormTab('detail')">Detail Objek</button></div>
            <form id="form-permohonan" onsubmit="submitForm(event)">
              <div id="form-tab-info">
                <div class="form-grid">
                  <div class="form-group"><label for="f-nomorberkas">Nomor Berkas *</label><input type="text" class="form-control" id="f-nomorberkas" placeholder="Contoh: BPN-NTB/CA/2025/001" required></div>
                  <div class="form-group"><label for="f-jenis">Jenis Dasar Permohonan *</label><select class="form-control" id="f-jenis" required><option value="">-- Pilih --</option><option value="cacat">Cacat Administrasi</option><option value="putusan">Putusan Pengadilan</option></select></div>
                  <div class="form-group"><label for="f-kantah">Kantor Pertanahan Pengusul *</label><select class="form-control" id="f-kantah" required><option value="">-- Pilih --</option><option>Kota Mataram</option><option>Lombok Barat</option><option>Lombok Tengah</option><option>Lombok Timur</option><option>Lombok Utara</option><option>Sumbawa</option><option>Sumbawa Barat</option><option>Dompu</option><option>Bima</option><option>Kota Bima</option></select></div>
                  <div class="form-group"><label for="f-tglUsulan">Tanggal Surat Usulan *</label><input type="date" class="form-control" id="f-tglUsulan" required></div>
                  <div class="form-group"><label for="f-pemohon">Nama Pemohon *</label><input type="text" class="form-control" id="f-pemohon" required></div>
                  <div class="form-group"><label for="f-kontak">No. HP / Kontak Pemohon</label><input type="text" class="form-control" id="f-kontak" placeholder="08xxxxxxxxxx"></div>
                  <div class="form-group">
                    <label for="f-pj">Penanggung Jawab Berkas *</label>
                    <input type="text" class="form-control" id="f-pj" required>
                    <small style="color:var(--text-muted); margin-top:4px; font-size:11px;" id="f-pj-help">Admin berhak menetapkan PJ berkas.</small>
                  </div>
                  
                  <div class="form-group full form-grid" style="grid-template-columns:1fr 1fr"><div class="form-group" id="f-noputs-group" style="display:none"><label for="f-noputs">Nomor Putusan Pengadilan</label><input type="text" class="form-control" id="f-noputs"></div></div>
                  
                  <div class="form-group full" style="grid-column:1/-1;">
                    <label for="f-dokumenusulan">Upload Dokumen Usulan (PDF)</label>
                    <input type="file" class="form-control" id="f-dokumenusulan" accept="application/pdf" style="padding:10px;">
                    <small style="color:var(--text-muted); margin-top:4px; font-size:11px;">Maksimal file 2MB.</small>
                  </div>
                </div>
              </div>
              
              <div id="form-tab-detail" style="display:none">
                <div class="form-grid">
                  <div class="form-group full" style="grid-column:1/-1;"><label for="f-pemeganghak">Nama Pemegang Hak *</label><input type="text" class="form-control" id="f-pemeganghak" required></div>
                  <div class="form-group"><label for="f-jenissert">Jenis Sertipikat</label><select class="form-control" id="f-jenissert"><option value="">-- Pilih --</option><option>Hak Milik</option><option>HGB</option><option>HGU</option><option>Hak Pakai</option><option>Hak Pengelolaan</option></select></div>
                  <div class="form-group"><label for="f-nosert">Nomor Sertipikat</label><input type="text" class="form-control" id="f-nosert"></div>
                  <div class="form-group full" style="grid-column:1/-1;"><label for="f-luas">Luas Tanah (m¬≤)</label><input type="number" class="form-control" id="f-luas" placeholder="0"></div>
                  
                  <div class="form-group full" style="grid-column:1/-1; margin-top:10px;"><label>Lokasi / Wilayah Administrasi Objek</label></div>
                  <div class="form-group full" style="grid-column:1/-1;"><label for="f-kabupaten">Kota / Kabupaten *</label><select class="form-control" id="f-kabupaten" onchange="handleKabupatenChange()" required><option value="">-- Pilih --</option></select></div>
                  <div class="form-group"><label for="f-kecamatan">Kecamatan *</label><select class="form-control" id="f-kecamatan" onchange="handleKecamatanChange()" disabled required><option value="">-- Pilih --</option></select></div>
                  <div class="form-group"><label for="f-desa">Desa / Kelurahan *</label><select class="form-control" id="f-desa" disabled required><option value="">-- Pilih --</option></select></div>
                  
                  <div class="form-group full" style="grid-column:1/-1; margin-top:10px;"><label for="f-dokumenbt">Upload Dokumen Buku Tanah / Surat Ukur (PDF)</label><input type="file" class="form-control" id="f-dokumenbt" accept="application/pdf" style="padding:10px;"><small style="color:var(--text-muted); margin-top:4px; font-size:11px;">Maksimal file 2MB.</small></div>
                  <div class="form-group full" style="grid-column:1/-1"><label for="f-uraian">Uraian Singkat Kasus</label><textarea class="form-control" id="f-uraian" style="min-height:100px"></textarea></div>
                </div>
              </div>
              
              <div class="divider"></div>
              <div style="display:flex;gap:10px;justify-content:flex-end">
                <button type="button" class="btn btn-secondary" onclick="navigateTo('dashboard')">Batal</button>
                <button type="button" class="btn btn-secondary" id="btn-prev-tab" style="display:none" onclick="prevFormTab()">‚Üê Kembali</button>
                <button type="button" class="btn btn-primary" id="btn-next-tab" onclick="nextFormTab()">Lanjut ‚Üí</button>
                <button type="submit" class="btn btn-primary" id="btn-submit" style="display:none">Simpan Data Usulan</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="page" id="page-detail">
        <button class="btn btn-ghost btn-sm" onclick="goBackFromDetail()" style="margin-bottom:16px"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg> Kembali</button>
        <div id="detail-content"></div>
      </div>

      <div class="page" id="page-kalender">
        <div class="page-header"><h1>Kalender <em>Kegiatan</em></h1></div>
        <div style="display:grid;grid-template-columns:1fr 300px;gap:24px" id="calendar-layout">
          <div class="card">
            <div class="card-header">
              <div style="display:flex;align-items:center;gap:16px"><span class="cal-month-label" id="full-cal-label"></span><div class="cal-nav-btns"><button class="cal-nav-btn" onclick="fullCalPrev()">‚ùÆ</button><button class="cal-nav-btn" onclick="fullCalToday()">Hari Ini</button><button class="cal-nav-btn" onclick="fullCalNext()">‚ùØ</button></div></div>
            </div>
            <div class="card-body"><div class="cal-days-header" style="grid-template-columns:repeat(7,1fr)"><div class="cal-day-name" style="color:#c0392b">Min</div><div class="cal-day-name">Sen</div><div class="cal-day-name">Sel</div><div class="cal-day-name">Rab</div><div class="cal-day-name">Kam</div><div class="cal-day-name">Jum</div><div class="cal-day-name">Sab</div></div><div class="cal-grid" id="full-cal-grid" style="gap:4px"></div></div>
          </div>
          <div style="display:flex;flex-direction:column;gap:16px" id="cal-add-panel">
            <div class="card">
              <div class="card-header"><span class="card-title">Tambah Kegiatan</span></div>
              <div class="card-body">
                <div class="form-group" style="margin-bottom:12px"><label for="new-event-date">Tanggal</label><input type="date" class="form-control" id="new-event-date"></div>
                <div class="form-group" style="margin-bottom:12px"><label for="new-event-title">Judul Kegiatan</label><input type="text" class="form-control" id="new-event-title"></div>
                <div class="form-group" style="margin-bottom:12px"><label for="new-event-berkas">Berkas Terkait</label><select class="form-control" id="new-event-berkas"></select></div>
                <div class="form-group" style="margin-bottom:16px"><label for="new-event-desc">Keterangan</label><textarea class="form-control" id="new-event-desc" style="min-height:60px"></textarea></div>
                <button class="btn btn-primary" style="width:100%" onclick="addCalendarEvent()">Simpan Kegiatan</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="page" id="page-pengaturan">
        <div class="page-header"><h1>Pengaturan <em>Akun</em></h1></div>
        <div class="settings-grid">
          <div class="card" style="height:fit-content;"><div class="card-header"><span class="card-title">Informasi Data Diri</span></div><div class="card-body"><p style="font-size:13px; color:var(--text-muted)">Pengaturan profil dibatasi untuk versi demo.</p></div></div>
        </div>
      </div>

    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-agenda"><div class="modal"><div class="modal-header"><div class="modal-title" id="modal-agenda-title"></div><button class="modal-close" onclick="closeModal('modal-agenda')">X</button></div><div class="modal-body" id="modal-agenda-body"></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('modal-agenda')">Tutup</button></div></div></div>
<div class="modal-overlay" id="modal-tahapan"><div class="modal"><div class="modal-header"><div class="modal-title">Update Tahapan</div><button class="modal-close" onclick="closeModal('modal-tahapan')">X</button></div><div class="modal-body" id="modal-tahapan-body"></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('modal-tahapan')">Batal</button><button class="btn btn-primary" onclick="saveTahapanUpdate()">Simpan & Unggah</button></div></div></div>
<div class="modal-overlay" id="modal-view-tahapan"><div class="modal"><div class="modal-header"><div class="modal-title">Detail Tahapan</div><button class="modal-close" onclick="closeModal('modal-view-tahapan')">X</button></div><div class="modal-body" id="modal-view-tahapan-body"></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('modal-view-tahapan')">Tutup</button><button class="btn btn-primary" id="btn-edit-tahapan">Edit Data</button></div></div></div>
<div class="modal-overlay" id="modal-tutup"><div class="modal"><div class="modal-header"><div class="modal-title">Tutup Berkas</div><button class="modal-close" onclick="closeModal('modal-tutup')">X</button></div><div class="modal-body"><p style="font-size:13px; color:var(--text-muted); margin-bottom:16px;">Berkas yang ditutup akan terkunci, dianggap selesai.</p><div class="form-group" style="margin-bottom:16px"><label>Alasan Penutupan *</label><textarea class="form-control" id="tutup-alasan" required></textarea></div><div class="form-group"><label>Unggah Dokumen (PDF) *</label><input type="file" class="form-control" id="tutup-file" accept="application/pdf" required></div></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('modal-tutup')">Batal</button><button class="btn btn-danger" onclick="saveTutupBerkas()">Tutup Berkas</button></div></div></div>
<div class="modal-overlay" id="modal-buka"><div class="modal"><div class="modal-header"><div class="modal-title">Buka Berkas</div><button class="modal-close" onclick="closeModal('modal-buka')">X</button></div><div class="modal-body"><div class="form-group"><label>Alasan Dibuka *</label><textarea class="form-control" id="buka-alasan" required></textarea></div></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('modal-buka')">Batal</button><button class="btn btn-primary" onclick="saveBukaBerkas()">Buka Berkas</button></div></div></div>
<div class="modal-overlay" id="modal-pdf-viewer"><div class="modal" style="width:95%; max-width:1000px; height:90vh; display:flex; flex-direction:column;"><div class="modal-header"><div class="modal-title" id="pdf-viewer-title" style="font-size:16px;">Pratinjau</div><button class="modal-close" onclick="closeModal('modal-pdf-viewer')">X</button></div><div class="modal-body" style="flex:1; padding:0; background:#E8E8E8;"><iframe id="pdf-iframe" style="width:100%; height:100%; border:none;"></iframe></div></div></div>
<div id="toast-container"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 1. DATA MASTER WILAYAH (Dipendekkan u/ ruang)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const rawNTB = {
  "Kota Mataram": { "Ampenan": "Ampenan Selatan,Ampenan Tengah", "Sekarbela": "Jempong Baru,Karang Pule" },
  "Lombok Barat": { "Batu Layar": "Senggigi,Batu Layar", "Gerung": "Gerung Selatan,Babussalam" }
};
const ntbData = {}; for (const kab in rawNTB) { ntbData[kab] = {}; for (const kec in rawNTB[kab]) { ntbData[kab][kec] = rawNTB[kab][kec].split(',').sort(); } }

function initWilayah() { const k = document.getElementById('f-kabupaten'); if(!k)return; k.innerHTML='<option value="">-- Pilih --</option>'; Object.keys(ntbData).sort().forEach(kab => k.add(new Option(kab, kab))); }
function handleKabupatenChange() { const k = document.getElementById('f-kabupaten').value, c = document.getElementById('f-kecamatan'), d = document.getElementById('f-desa'); c.innerHTML='<option value="">-- Pilih --</option>'; d.innerHTML='<option value="">-- Pilih --</option>'; d.disabled=true; if(k&&ntbData[k]){ c.disabled=false; Object.keys(ntbData[k]).sort().forEach(kec => c.add(new Option(kec, kec))); } else c.disabled=true; }
function handleKecamatanChange() { const k = document.getElementById('f-kabupaten').value, c = document.getElementById('f-kecamatan').value, d = document.getElementById('f-desa'); d.innerHTML='<option value="">-- Pilih --</option>'; if(k&&c&&ntbData[k][c]){ d.disabled=false; ntbData[k][c].forEach(desa => d.add(new Option(desa, desa))); d.add(new Option("Lainnya...","Lainnya"));} else d.disabled=true; }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 2. SISTEM RBAC (ROLE-BASED ACCESS CONTROL) & LOGIN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const USERS = {
  'admin': { id: 'admin', pass: 'admin123', name: 'Budi Santoso', role: 'admin_kanwil', label: 'Admin Kanwil' },
  'operator': { id: 'operator', pass: 'op123', name: 'Siti Aminah', role: 'operator_kanwil', label: 'Operator Kanwil' },
  'pimpinan': { id: 'pimpinan', pass: 'pim123', name: 'Dr. H. Kakanwil', role: 'pimpinan', label: 'Pimpinan' }
};

let currentUser = null;

function checkLogin() {
  const storedUser = localStorage.getItem('sipentas-user');
  if (storedUser) { 
    currentUser = JSON.parse(storedUser);
    document.getElementById('login-container').style.display = 'none'; 
    document.getElementById('app-container').style.display = 'flex'; 
    applyRoleUI();
  } else { 
    document.getElementById('login-container').style.display = 'flex'; 
    document.getElementById('app-container').style.display = 'none'; 
  }
}

function handleLogin(e) {
  e.preventDefault(); 
  const user = document.getElementById('l-username').value; 
  const pass = document.getElementById('l-password').value;
  
  const foundUser = USERS[user];
  if (foundUser && foundUser.pass === pass) { 
    localStorage.setItem('sipentas-user', JSON.stringify(foundUser)); 
    showToast(`Berhasil masuk sebagai ${foundUser.label}`, 'success'); 
    document.getElementById('l-password').value = ''; 
    checkLogin(); 
  } else { 
    showToast('NIP atau Sandi salah.', 'error'); 
  }
}

function logout() { if(confirm('Keluar dari sistem?')) { localStorage.removeItem('sipentas-user'); currentUser = null; checkLogin(); } }
function togglePassword() { const i = document.getElementById('l-password'); i.type = i.type === 'password' ? 'text' : 'password'; }
function toggleUserMenu(e) { e.stopPropagation(); document.getElementById('user-dropdown').classList.toggle('show'); }
window.addEventListener('click', function(e) { const d = document.getElementById('user-dropdown'); if(d && d.classList.contains('show')) d.classList.remove('show'); });

// GATEKEEPER UI BERDASARKAN ROLE
function applyRoleUI() {
  // Update Topbar Profile
  document.getElementById('topbar-user-name').textContent = currentUser.name;
  document.getElementById('topbar-avatar-initials').textContent = currentUser.name.substring(0,2).toUpperCase();
  document.getElementById('topbar-role-text').textContent = currentUser.label;
  document.getElementById('dropdown-role-info').textContent = `Masuk sebagai ${currentUser.label}`;

  // Warna Role Badge
  const badge = document.getElementById('topbar-role-badge');
  if(currentUser.role === 'admin_kanwil') { badge.style.color = '#1B5E20'; badge.querySelector('.dot').style.background = '#1B5E20'; }
  else if(currentUser.role === 'operator_kanwil') { badge.style.color = '#B7791F'; badge.querySelector('.dot').style.background = '#B7791F'; }
  else { badge.style.color = '#6A1B9A'; badge.querySelector('.dot').style.background = '#6A1B9A'; }

  // Sidebar Menu & Halaman Tambah
  if (currentUser.role === 'pimpinan') {
    document.getElementById('nav-tambah').style.display = 'none';
    document.getElementById('cal-add-panel').style.display = 'none'; // Sembunyikan tambah agenda
  } else {
    document.getElementById('nav-tambah').style.display = 'flex';
    document.getElementById('cal-add-panel').style.display = 'flex';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 3. DATABASE, AUDIT TRAIL, & UTILITIES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let cases = JSON.parse(localStorage.getItem('sipentas-cases') || '[]');
let calendarEvents = JSON.parse(localStorage.getItem('sipentas-events') || '[]');

const TAHAPAN_LABELS = ['Surat Usulan dari Kantah', 'Telaah Staff', 'Penelitian Lapang', 'Gelar Kasus', 'Penerbitan SK Pembatalan', 'Laporan Penyelesaian Kasus'];
const STATUS_MAP = { 0:{label:'Usulan Masuk',cls:'status-0'}, 1:{label:'Telaah Staff',cls:'status-1'}, 2:{label:'Penelitian Lapang',cls:'status-2'}, 3:{label:'Gelar Kasus',cls:'status-3'}, 4:{label:'Penerbitan SK',cls:'status-4'}, 5:{label:'Selesai',cls:'status-5'} };
const MONTHS = ['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember']; 

function saveData() { localStorage.setItem('sipentas-cases', JSON.stringify(cases)); localStorage.setItem('sipentas-events', JSON.stringify(calendarEvents)); }
function escapeHTML(str) { if (typeof str !== 'string') return str; return str.replace(/[&<>'"]/g, tag => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', "'": '&#39;', '"': '&quot;' }[tag] || tag)); }
function formatNumber(num) { if (!num) return '0'; return new Intl.NumberFormat('id-ID').format(num); }
function fmtDate(str) { if (!str) return '-'; const d = new Date(str); return isNaN(d) ? str : `${d.getDate()} ${MONTHS[d.getMonth()]} ${d.getFullYear()}`; }
function fmtTime(str) { const d = new Date(str); return `${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`; }
function readFileAsBase64(file) { return new Promise((resolve, reject) => { const reader = new FileReader(); reader.onload = () => resolve(reader.result); reader.onerror = e => reject(e); reader.readAsDataURL(file); }); }
function showToast(msg, type = '') { const c = document.getElementById('toast-container'), t = document.createElement('div'); t.className = 'toast ' + type; t.innerHTML = msg; c.appendChild(t); setTimeout(() => t.remove(), 3000); }
function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); if(id==='modal-pdf-viewer') setTimeout(()=>document.getElementById('pdf-iframe').src='',300); }
document.querySelectorAll('.modal-overlay').forEach(ov => { ov.addEventListener('click', function(e) { if (e.target === this) closeModal(this.id); }); });
function toggleSidebar() { document.querySelector('.sidebar').classList.toggle('open'); document.querySelector('.sidebar-overlay').classList.toggle('active'); }

function previewPDF(base64Data, fileName) {
  if (!base64Data) return; try { const arr = base64Data.split(','); const chars = atob(arr[1]); const nums = new Array(chars.length); for(let i=0;i<chars.length;i++) nums[i] = chars.charCodeAt(i); const blob = new Blob([new Uint8Array(nums)], {type: 'application/pdf'}); document.getElementById('pdf-viewer-title').textContent = fileName; document.getElementById('pdf-iframe').src = URL.createObjectURL(blob); openModal('modal-pdf-viewer'); } catch(e) { showToast('Gagal memuat dokumen', 'error'); }
}
function viewDocument(id, type) { const c = cases.find(x=>x.id===id); if(!c)return; if(type==='usulan'&&c.dokumenUsulan?.file) previewPDF(c.dokumenUsulan.file, c.dokumenUsulan.name); else if(type==='bt'&&c.dokumenbt?.file) previewPDF(c.dokumenbt.file, c.dokumenbt.name); else if(type==='tutup'&&c.closeDoc?.file) previewPDF(c.closeDoc.file, c.closeDoc.name); }
function viewTahapanDocument(id, idx) { const c = cases.find(x=>x.id===id); if(!c)return; const t=c.tahapan[idx]; if(t?.file) previewPDF(t.file, t.fileName); }

// LOG AKTIVITAS (AUDIT TRAIL CORE)
function logActivity(caseId, actionDesc) {
  const c = cases.find(x => x.id === caseId);
  if (c) {
    if (!c.auditTrail) c.auditTrail = [];
    c.auditTrail.unshift({ // Tambah ke atas (terbaru di atas)
      date: new Date().toISOString(),
      userName: currentUser.name,
      userRole: currentUser.label,
      action: actionDesc
    });
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 4. NAVIGASI, DASHBOARD, & TABEL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentPage = 'dashboard'; let prevPage = 'dashboard';
function navigateTo(page, param) {
  prevPage = currentPage; currentPage = page;
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById('page-' + page)?.classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n => { n.classList.remove('active'); if (n.getAttribute('onclick')?.includes(`'${page}'`)) n.classList.add('active'); });
  if (page === 'list-cacat' || page === 'list-putusan') renderTable(page.split('-')[1]);
  if (page === 'dashboard') { updateStats(); renderDashboard(); renderMiniCal(); renderCharts(); }
  if (page === 'tambah') resetForm(param);
  if (page === 'kalender') { renderFullCal(); const s=document.getElementById('new-event-berkas'); if(s) s.innerHTML='<option value="">-- Pilih Berkas --</option>'+cases.filter(c=>!c.isClosed).map(c=>`<option value="${c.id}">${c.nomorberkas}</option>`).join(''); }
}

function updateStats() {
  document.getElementById('stat-total').textContent = cases.length; document.getElementById('stat-cacat').textContent = cases.filter(c=>c.jenis==='cacat').length;
  document.getElementById('stat-putusan').textContent = cases.filter(c=>c.jenis==='putusan').length; document.getElementById('stat-selesai').textContent = cases.filter(c=>c.currentStep>=5||c.isClosed).length;
}

let kantahChartInstance = null; let typeChartInstance = null;
function renderCharts() {
  const ctxK = document.getElementById('kantahChart'); const ctxT = document.getElementById('typeChart'); if (!ctxK || !ctxT) return;
  const kC = {}; cases.forEach(c => kC[c.kantah] = (kC[c.kantah] || 0) + 1);
  if (kantahChartInstance) kantahChartInstance.destroy(); if (typeChartInstance) typeChartInstance.destroy();
  kantahChartInstance = new Chart(ctxK, { type: 'bar', data: { labels: Object.keys(kC).length ? Object.keys(kC) : ['Kosong'], datasets: [{ data: Object.keys(kC).length ? Object.values(kC) : [0], backgroundColor: '#050505', borderRadius: 6 }] }, options: { plugins: { legend: { display: false } }, maintainAspectRatio: false } });
  typeChartInstance = new Chart(ctxT, { type: 'doughnut', data: { labels: ['Cacat Adm', 'Putusan PN'], datasets: [{ data: [cases.filter(c=>c.jenis==='cacat').length, cases.filter(c=>c.jenis==='putusan').length], backgroundColor: ['#050505', '#B3B3B3'] }] }, options: { cutout: '70%', maintainAspectRatio: false } });
}

function renderDashboard() {
  const tbody = document.getElementById('recent-cases-tbody'); const recent = [...cases].sort((a,b) => new Date(b.tglUsulan) - new Date(a.tglUsulan)).slice(0,8);
  if (!recent.length) { tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#999;padding:20px">Kosong</td></tr>'; return; }
  tbody.innerHTML = recent.map(c => `<tr><td><code>${c.nomorberkas}</code></td><td>${c.pemohon}</td><td>${c.jenis==='cacat'?'Cacat':'Putusan'}</td><td>${c.kantah}</td><td><span class="status-badge ${STATUS_MAP[c.currentStep].cls}">${c.isClosed?'Ditutup':STATUS_MAP[c.currentStep].label}</span></td></tr>`).join('');
}

function renderTable(type) {
  const tbody = document.getElementById(`tbody-${type}`); const search = (document.getElementById('global-search')?.value || '').toLowerCase(); const filter = document.getElementById(`filter-status-${type}`)?.value;
  let fil = cases.filter(c => c.jenis === type);
  if (search) fil = fil.filter(c => c.nomorberkas.toLowerCase().includes(search) || c.pemohon.toLowerCase().includes(search));
  if (filter !== '' && filter !== undefined) fil = fil.filter(c => String(c.currentStep) === String(filter));

  if (!fil.length) { tbody.innerHTML = `<tr><td colspan="9" style="text-align:center;color:#999;padding:30px">Tidak ada data</td></tr>`; return; }
  tbody.innerHTML = fil.map(c => {
    let prog = c.isClosed ? 100 : Math.round((c.currentStep/5)*100);
    
    // ROLE CHECK UNTUK TOMBOL HAPUS (HANYA ADMIN)
    let btnHapus = '';
    if (currentUser.role === 'admin_kanwil') {
      btnHapus = `<button class="btn btn-danger btn-sm" onclick="deleteCase('${c.id}')">Hapus</button>`;
    }

    return `<tr onclick="openDetail('${c.id}')"><td><code>${c.nomorberkas}</code></td><td>${c.kantah}</td><td>${c.pemohon}</td><td>${type==='putusan'?c.noputs||'-':c.nosert||'-'}</td><td>${c.desa||'-'}</td><td>${fmtDate(c.tglUsulan)}</td><td><span class="status-badge ${c.isClosed?'':STATUS_MAP[c.currentStep]?.cls}">${c.isClosed?'üîí Ditutup':STATUS_MAP[c.currentStep]?.label}</span></td><td>${prog}%</td><td onclick="event.stopPropagation()"><div style="display:flex;gap:6px"><button class="btn btn-secondary btn-sm" onclick="openDetail('${c.id}')">Detail</button>${btnHapus}</div></td></tr>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 5. FORM TAMBAH & UPDATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentFormTab = 'info'; const formTabs = ['info', 'detail']; 
function switchFormTab(tab) { formTabs.forEach(t => document.getElementById('form-tab-'+t).style.display = t===tab?'':'none'); document.querySelectorAll('.tabs .tab').forEach((b,i)=>b.classList.toggle('active',formTabs[i]===tab)); currentFormTab=tab; document.getElementById('btn-prev-tab').style.display=tab==='info'?'none':''; document.getElementById('btn-next-tab').style.display=tab==='detail'?'none':''; document.getElementById('btn-submit').style.display=tab==='detail'?'':'none'; }
function nextFormTab() { if(currentFormTab==='info') switchFormTab('detail'); } function prevFormTab() { if(currentFormTab==='detail') switchFormTab('info'); }

function resetForm(preselect) { 
  document.getElementById('form-permohonan').reset(); if(preselect) document.getElementById('f-jenis').value = preselect; 
  switchFormTab('info'); togglePutsanField(); document.getElementById('f-jenis').addEventListener('change', togglePutsanField); 
  initWilayah(); 

  // ROLE CHECK: Jika Operator, paksa PJ menjadi namanya
  const pjInput = document.getElementById('f-pj');
  const pjHelp = document.getElementById('f-pj-help');
  if(currentUser.role === 'operator_kanwil') {
    pjInput.value = currentUser.name;
    pjInput.readOnly = true;
    pjInput.style.backgroundColor = 'var(--surface)';
    pjHelp.textContent = "Anda terdaftar sebagai PJ berkas ini secara otomatis.";
  } else {
    pjInput.readOnly = false;
    pjInput.style.backgroundColor = 'var(--white)';
    pjHelp.textContent = "Admin dapat menetapkan siapa saja menjadi PJ.";
  }
}
function togglePutsanField() { document.getElementById('f-noputs-group').style.display = document.getElementById('f-jenis').value === 'putusan' ? 'block' : 'none'; }

async function submitForm(e) { 
  e.preventDefault(); const j = document.getElementById('f-jenis').value; 
  let uD = { file: null, name: '' }, bD = { file: null, name: '' };
  const uI = document.getElementById('f-dokumenusulan'), bI = document.getElementById('f-dokumenbt');
  if(uI.files[0]) { uD.file = await readFileAsBase64(uI.files[0]); uD.name = uI.files[0].name; }
  if(bI.files[0]) { bD.file = await readFileAsBase64(bI.files[0]); bD.name = bI.files[0].name; }

  const newId = 'c' + Date.now();
  cases.push({ 
    id: newId, nomorberkas: document.getElementById('f-nomorberkas').value, jenis: j, kantah: document.getElementById('f-kantah').value, 
    tglUsulan: document.getElementById('f-tglUsulan').value, pemohon: document.getElementById('f-pemohon').value, kontak: document.getElementById('f-kontak').value, pj: document.getElementById('f-pj').value, 
    noputs: document.getElementById('f-noputs').value, dokumenUsulan: uD, pemeganghak: document.getElementById('f-pemeganghak').value, jenissert: document.getElementById('f-jenissert').value, nosert: document.getElementById('f-nosert').value, 
    luas: document.getElementById('f-luas').value, kabupaten: document.getElementById('f-kabupaten').value, kecamatan: document.getElementById('f-kecamatan').value, desa: document.getElementById('f-desa').value, dokumenbt: bD, uraian: document.getElementById('f-uraian').value, 
    tahapan: Array(6).fill({date:'',note:'',file:null,fileName:''}), currentStep: 0, isClosed: false, auditTrail: [] 
  }); 

  logActivity(newId, `Mendaftarkan usulan permohonan baru (${j === 'cacat' ? 'Cacat Adm' : 'Putusan PN'}).`);
  saveData(); updateStats(); showToast('Tersimpan!', 'success'); navigateTo(j==='cacat'?'list-cacat':'list-putusan'); 
}

let updId='', updIdx=0;
function openUpdateTahapan(id, idx) { updId=id; updIdx=idx; const c=cases.find(x=>x.id===id); document.getElementById('modal-tahapan-body').innerHTML = `<div class="form-group mb-3"><label>Tanggal Selesai *</label><input type="date" class="form-control" id="u-d" value="${c.tahapan[idx].date}"></div><div class="form-group mb-3"><label>Catatan</label><textarea class="form-control" id="u-n">${c.tahapan[idx].note}</textarea></div><div class="form-group"><label>Dokumen Bukti (PDF)</label><input type="file" class="form-control" id="u-f"></div>`; openModal('modal-tahapan'); }
async function saveTahapanUpdate() {
  const d=document.getElementById('u-d').value, n=document.getElementById('u-n').value, fI=document.getElementById('u-f'); if(!d){showToast('Isi tanggal!','error');return;}
  const c=cases.find(x=>x.id===updId); let fD=c.tahapan[updIdx].file, fN=c.tahapan[updIdx].fileName;
  if(fI.files[0]){ fD = await readFileAsBase64(fI.files[0]); fN = fI.files[0].name; }
  c.tahapan[updIdx] = { date:d, note:n, file:fD, fileName:fN };
  c.currentStep = c.tahapan.reduce((acc, t, i) => t?.date ? i + 1 : acc, 0); 
  
  logActivity(updId, `Memperbarui status ke tahapan: <strong>${TAHAPAN_LABELS[updIdx]}</strong>.`);
  saveData(); closeModal('modal-tahapan'); showToast('Tahapan update!','success'); openDetail(updId);
}

function deleteCase(id) { 
  if(!confirm('Hapus permanen?'))return; cases=cases.filter(x=>x.id!==id); saveData(); updateStats(); renderTable(currentPage.split('-')[1]); showToast('Dihapus'); 
}

let actId=null;
function promptTutupBerkas(id){ actId=id; document.getElementById('tutup-alasan').value=''; document.getElementById('tutup-file').value=''; openModal('modal-tutup'); }
async function saveTutupBerkas(){ const a=document.getElementById('tutup-alasan').value, fI=document.getElementById('tutup-file'); if(!a||!fI.files[0])return showToast('Lengkapi data','error'); const c=cases.find(x=>x.id===actId); c.isClosed=true; c.closeReason=a; c.closeDoc={file:await readFileAsBase64(fI.files[0]), name:fI.files[0].name}; c.reopenReason=''; logActivity(actId, `Mengunci dan <strong>Menutup Berkas</strong> secara permanen. Alasan: ${a}`); saveData(); closeModal('modal-tutup'); openDetail(actId); }
function promptBukaBerkas(id){ actId=id; document.getElementById('buka-alasan').value=''; openModal('modal-buka'); }
function saveBukaBerkas(){ const a=document.getElementById('buka-alasan').value; if(!a)return; const c=cases.find(x=>x.id===actId); c.isClosed=false; c.reopenReason=a; logActivity(actId, `<strong>Membuka Kembali Berkas</strong> yang terkunci. Alasan: ${a}`); saveData(); closeModal('modal-buka'); openDetail(actId); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 6. TAMPILAN DETAIL KASUS & LOG AKTIVITAS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openDetail(id) {
  const c = cases.find(x => x.id === id); if (!c) return; prevPage = currentPage; currentPage = 'detail';

  // ROLE CHECK LOGIC
  const isAdmin = currentUser.role === 'admin_kanwil';
  const isOperator = currentUser.role === 'operator_kanwil';
  const isPimpinan = currentUser.role === 'pimpinan';
  
  // Operator bisa edit jika dia adalah PJ nya. Admin bisa edit semua.
  const canEdit = isAdmin || (isOperator && c.pj === currentUser.name);

  const steps = TAHAPAN_LABELS.map((label, i) => {
    let isCompleted = !!c.tahapan?.[i]?.date;
    let cls = isCompleted ? 'success' : (i === c.currentStep && !c.isClosed ? 'active' : 'pending');
    let dateStr = c.tahapan?.[i]?.date ? fmtDate(c.tahapan[i].date) : ''; 
    let shortNote = (c.tahapan?.[i]?.note || '').substring(0, 55); 
    
    let actionBtn = '';
    // HANYA MUNCUL JIKA CAN EDIT
    if (canEdit && !c.isClosed && i === c.currentStep) {
      actionBtn = `<button class="btn btn-primary btn-sm" style="margin-left:auto;" onclick="openUpdateTahapan('${id}',${i})">Update</button>`;
    } else if (isCompleted) {
      actionBtn = `<button class="btn btn-secondary btn-sm" style="margin-left:auto;" onclick="viewTahapan('${id}',${i})">Detail</button>`;
    }

    return `<div class="step-item"><div class="step-num ${cls}">${i+1}</div><div class="step-content"><div class="step-title">${label}</div><div class="step-date">${dateStr}</div><div class="step-note" style="display:${shortNote?'block':'none'}">${escapeHTML(shortNote)}</div></div>${actionBtn}</div>`;
  }).join('');

  // ADMIN ACTIONS (Hanya Admin yang bisa tutup/buka berkas)
  let adminActions = '';
  if (isAdmin) {
    adminActions = c.isClosed 
      ? `<button class="btn btn-secondary btn-sm" onclick="promptBukaBerkas('${id}')">Buka Berkas</button>` 
      : `<button class="btn btn-danger btn-sm" onclick="promptTutupBerkas('${id}')">Tutup Berkas</button>`;
  }

  // RENDER AUDIT TRAIL
  let auditHtml = '<p style="font-size:12px;color:var(--text-muted);text-align:center;">Belum ada log aktivitas.</p>';
  if (c.auditTrail && c.auditTrail.length > 0) {
    auditHtml = c.auditTrail.map(log => `
      <div class="audit-item">
        <div class="audit-dot"></div>
        <div class="audit-content">
          <div class="audit-header">
            <div><span class="audit-user">${escapeHTML(log.userName)}</span><span class="audit-role">${escapeHTML(log.userRole)}</span></div>
            <span class="audit-time">${fmtDate(log.date)} ${fmtTime(log.date)}</span>
          </div>
          <div class="audit-action">${log.action}</div>
        </div>
      </div>
    `).join('');
  }

  document.getElementById('detail-content').innerHTML = `
    ${adminActions ? `<div style="display:flex; justify-content:space-between; margin-bottom:16px;"><b>Opsi Admin</b>${adminActions}</div>` : ''}
    ${c.isClosed ? `<div style="background:#FFF5F5; color:#C0392B; padding:16px; border-radius:8px; margin-bottom:20px;"><b>üîí BERKAS DITUTUP</b><br>Alasan: ${c.closeReason} <br><button class="btn btn-danger btn-sm mt-2" onclick="viewDocument('${id}','tutup')">Lihat Surat</button></div>` : ''}
    
    <div class="detail-header">
      <div class="detail-case-id">ID BERKAS: ${c.id}</div>
      <div class="detail-title">${escapeHTML(c.nomorberkas)}</div>
      <div class="detail-metas">
        <div class="detail-meta-item"><strong>Pemohon:</strong>${escapeHTML(c.pemohon)}</div>
        <div class="detail-meta-item"><strong>PJ:</strong>${escapeHTML(c.pj)}</div>
        <div class="detail-meta-item"><strong>Kantah:</strong>${escapeHTML(c.kantah)}</div>
      </div>
      <button class="btn btn-secondary btn-sm" style="margin-top:16px;" onclick="viewDocument('${id}','usulan')">üìÑ Surat Usulan</button>
      <button class="btn btn-secondary btn-sm" style="margin-top:16px; margin-left:8px;" onclick="viewDocument('${id}','bt')">üìÑ Buku Tanah</button>
    </div>
    
    <div style="display:grid;grid-template-columns:1fr 380px;gap:20px" class="dashboard-grid">
      <div class="card"><div class="card-header"><span class="card-title">Riwayat Tahapan</span></div><div class="card-body"><div class="stepper">${steps}</div></div></div>
      
      <div style="display:flex;flex-direction:column;gap:16px">
        <div class="card">
          <div class="card-header"><span class="card-title">Informasi Objek</span></div>
          <div class="card-body">
            <div class="info-grid">
              <div class="info-item"><span>${escapeHTML(c.pemeganghak)}</span></div>
              <div class="info-item"><span>${escapeHTML(c.jenissert)} ${escapeHTML(c.nosert)}</span></div>
              <div class="info-item"><span>${c.luas} m¬≤</span></div>
            </div>
            <hr style="border:0; border-top:1px solid var(--border); margin:12px 0;">
            <p style="font-size:12px;"><b>Lokasi:</b> ${c.desa}, ${c.kecamatan}, ${c.kabupaten}</p>
          </div>
        </div>

        <div class="card">
          <div class="card-header"><span class="card-title">Log Aktivitas (Audit Trail)</span></div>
          <div class="card-body" style="max-height: 400px; overflow-y:auto; padding-top:12px;">
            <div class="audit-timeline">${auditHtml}</div>
          </div>
        </div>
      </div>
    </div>`;

  document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); 
  document.getElementById('page-detail').classList.add('active'); 
}

function goBackFromDetail() { navigateTo(prevPage==='detail'?'dashboard':prevPage); }

function viewTahapan(id, idx) {
  const c = cases.find(x=>x.id===id); const t = c.tahapan[idx];
  document.getElementById('modal-view-tahapan-body').innerHTML = `
    <h3>${TAHAPAN_LABELS[idx]}</h3><p><b>Tgl:</b> ${fmtDate(t.date)}</p><p><b>Catatan:</b> ${t.note}</p>
    ${t.file ? `<button class="btn btn-primary" onclick="viewTahapanDocument('${id}', ${idx})">Lihat PDF</button>` : ''}`;
  
  const b = document.getElementById('btn-edit-tahapan');
  if(c.isClosed || (currentUser.role === 'pimpinan') || (currentUser.role === 'operator_kanwil' && c.pj !== currentUser.name)) b.style.display = 'none';
  else { b.style.display = 'inline-block'; b.onclick = () => { closeModal('modal-view-tahapan'); openUpdateTahapan(id, idx); }; }
  
  openModal('modal-view-tahapan');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 7. KALENDER (Disimplifikasi)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let miniCalDate=new Date(), fullCalDate=new Date();
function renderMiniCal(){ document.getElementById('mini-cal-label').textContent=`${MONTHS[miniCalDate.getMonth()]} ${miniCalDate.getFullYear()}`; }
function renderFullCal(){ document.getElementById('full-cal-label').textContent=`${MONTHS[fullCalDate.getMonth()]} ${fullCalDate.getFullYear()}`; }
function miniCalPrev(){ miniCalDate.setMonth(miniCalDate.getMonth()-1); renderMiniCal(); } function miniCalNext(){ miniCalDate.setMonth(miniCalDate.getMonth()+1); renderMiniCal(); }
function fullCalPrev(){ fullCalDate.setMonth(fullCalDate.getMonth()-1); renderFullCal(); } function fullCalNext(){ fullCalDate.setMonth(fullCalDate.getMonth()+1); renderFullCal(); }
function fullCalToday(){ fullCalDate=new Date(); renderFullCal(); }
function openDayModal(k){ openModal('modal-agenda'); }
function addCalendarEvent(){ closeModal('modal-agenda'); showToast('Tersimpan!','success'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 8. INISIALISASI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
if (cases.length === 0) { 
  cases = [ { id: 'c1', nomorberkas: 'BPN/001', jenis: 'cacat', kantah: 'Kota Mataram', tglUsulan: '2025-02-10', pemohon: 'H. Ahmad', pj: 'Siti Aminah', pemeganghak: 'H. Ahmad', luas: '250', kabupaten: 'Kota Mataram', kecamatan: 'Sekarbela', desa: 'Jempong Baru', tahapan: [{date:'2025-02-10', note:'Berkas dianalisa'}], currentStep: 1, isClosed: false, auditTrail: [{date: new Date().toISOString(), userName: 'System', userRole: 'INIT', action: 'Data disinkronisasi awal'}] } ]; 
  saveData(); 
}

checkLogin();
</script>
</body>
</html>
